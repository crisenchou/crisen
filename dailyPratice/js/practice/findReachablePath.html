<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>寻找最短可行路径</title>
    <style>
        #map {
            height: 400px;
            width: 400px;
        }
    </style>
</head>
<body>
<div>
    <canvas id="map"></canvas>
</div>
<div>
    <input type="button" value="设置障碍"/>
    <input type="button" value="设置起点/终点"/>
    <input type="button" value="开始寻路"/>
</div>
</body>
<script>

    function Map(canvas) {
        this.canvas = document.getElementById(canvas);
        this.brush = new Draw(canvas);
        this.init = function () {
            //this.brush.drawDot(0, 0, 'red', this.canvas.offsetHeight, this.canvas.offsetWidth);//初始化画布
        }
    }

    function Draw(canvas) {
        this.cxt = document.getElementById(canvas).getContext("2d");
        this.drawDot = function (x, y, color, length, size) {
            length = length || 10;
            size = size || 10;
            this.cxt.fillStyle = color;
            this.cxt.fillRect(x, y, length, size);
        }
    }

    var map = new Map('map');
    map.init();


    var direction = [
        [0, 1], //east
        [1, 0],//south
        [0, -1],//west
        [-1, 0]//north
    ];

    //point is in map
    function inMap(x, y) {
        return (x >= 0 && y >= 0 && x < 10 && y < 10)
    }

    //坐标
    function Point(x, y) {
        this.x = x;
        this.y = y;
    }

    //地图结点
    function MapNode(x, y, reachable, value) {
        this.x = x;
        this.y = y;
        this.reachable = reachable;
        this.sur = null;
        this.value = value;
    }


    function initGraph(table) {
        var g = new Array(10);
        var i, j;
        for (i = 0; i < 10; i++) {
            g[i] = new Array(10);
            for (j = 0; j < 10; j++) {
                var node = new MapNode(i, j, 0, 0);
                node.value = table[i][j];
                if (table[i][j] == 0) {
                    node.reachable = 1;
                }
                g[i][j] = node;
            }
        }
        return g;
    }


    function nodeExist(p, close) {
        if (close.length) {
            for (var i in close) {
                if (close[i].x == p.x && close[i].y == p.y) {
                    return true;
                }
            }
        }
        return false;
    }


    function dijkstra(graph, startX, startY, endX, endY) {
        var open = [];
        var close = [];
        open.push(graph[startX][startY]);
        var times = 0;

        while (open.length) {
            var p = open.shift();
            var curX = p.x;
            var curY = p.y;
            var surX, surY;
            if (nodeExist(p, close)) {
                continue;
            }

            if (p.x == endX && p.y == endY) {
                break;
            }

            for (var i = 0; i < 4; i++) {
                surX = curX + direction[i][0];
                surY = curY + direction[i][1];

                if (!inMap(surX, surY)) {
                    continue;
                }

                if (nodeExist(graph[surX][surY], open)) {
                    continue;
                }

                if (nodeExist(graph[surX][surY], close)) {
                    continue;
                }


                if (graph[surX][surY].reachable) {
                    graph[surX][surY].sur = p;
                    open.push(graph[surX][surY]);
                    times++;
                }
            }
            close.push(p);
        }
        console.log(times)
        return graph;
    }


    // 0 能访问  1 障碍  2 路径点  3 起点  4 终点

    var table = [
        [0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ];


    var graph = initGraph(table);

    //console.log(graph);

    graph = dijkstra(graph, 0, 0, 8, 8);

    var dest = graph[8][8];
    //console.log(graph);
    //console.log(dest);

    while (dest.sur != null) {
        //console.log(dest.x, dest.y);
        dest = dest.sur;
        table[dest.x][dest.y] = 2;
    }

    console.log(table);

    //console.log(table);
    for (var i = 0; i < 10; i++) {
        for (var j = 0; j < 10; j++) {
            var x = i * 15;
            var y = j * 15;
            var crlorful = "red";
            if (table[i][j] == 2) {
                crlorful = "blue";
            }
            if (table[i][j] == 1) {
                crlorful = "black";
            }
            map.brush.drawDot(y, x, crlorful, 10, 5)
        }
    }


    //f第一步创建一个图
    // console.log(graph);


    //第二步 对图使用dijkstra算法 采用open close的方法

    // 找到终点链表  寻找ij 对map进行着色


    //console.log(d);
    //console.log(path);

    //var start = [0, 0];
    //var end = [8, 8];

</script>
</html>